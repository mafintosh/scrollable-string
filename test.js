var tape = require('tape')
var scrollable = require('./')

tape('box.toString()', function (t) {
  var str = scrollable('foo\nbar\nbaz\n', {maxHeight: 1})
  t.equal(str.toString(), 'foo\n')
  t.end()
})

tape('box.setPosition()', function (t) {
  var str = scrollable('foo\nbar\nbaz\n', {maxHeight: 1})
  t.equal(str.toString(), 'foo\n')
  t.notOk(str.setPosition(0))
  t.equal(str.toString(), 'foo\n')
  t.ok(str.setPosition(1))
  t.equal(str.toString(), 'bar\n')
  t.ok(str.setPosition(42))
  t.equal(str.toString(), 'baz\n')
  t.notOk(str.setPosition(42))
  t.end()
})

tape('box.move()', function (t) {
  var str = scrollable('foo\nbar\nbaz\n', {maxHeight: 1})
  t.equal(str.toString(), 'foo\n')
  t.notOk(str.move(0))
  t.equal(str.toString(), 'foo\n')
  t.ok(str.move(1))
  t.equal(str.toString(), 'bar\n')
  t.ok(str.move(42))
  t.equal(str.toString(), 'baz\n')
  t.notOk(str.move(42))
  t.ok(str.move(-2))
  t.equal(str.toString(), 'foo\n')
  t.end()
})

tape('box.atTop()', function (t) {
  var str = scrollable('foo\nbar\nbaz\n', {maxHeight: 1})
  t.ok(str.atTop())
  str.move(1)
  t.notOk(str.atTop())
  t.end()
})

tape('box.atBottom()', function (t) {
  var str = scrollable('foo\nbar\nbaz\n', {maxHeight: 1})
  t.notOk(str.atBottom())
  str.move(2)
  t.ok(str.atBottom())
  t.end()
})

tape('box.scrollable()', function (t) {
  var s1 = scrollable('foo\nbar\nbaz\n', {maxHeight: 1})
  t.ok(s1.scrollable())
  var s2 = scrollable('foo\nbar\nbaz\n', {maxHeight: 3})
  t.notOk(s2.scrollable())
  var s3 = scrollable('foo\nbar\nbaz\n', {maxHeight: 4})
  t.notOk(s3.scrollable())
  t.end()
})

tape('box.top()', function (t) {
  var str = scrollable('foo\nbar\nbaz\n', {maxHeight: 1})
  str.move(1)
  t.equal(str.toString(), 'bar\n')
  t.ok(str.top())
  t.equal(str.toString(), 'foo\n')
  t.notOk(str.top())
  t.end()
})

tape('box.bottom()', function (t) {
  var str = scrollable('foo\nbar\nbaz\n', {maxHeight: 1})
  t.equal(str.toString(), 'foo\n')
  t.ok(str.bottom())
  t.equal(str.toString(), 'baz\n')
  t.notOk(str.bottom())
  t.end()
})

tape('box.moveToTop()', function (t) {
  var str = scrollable('foo\nbar\nbaz\n', {maxHeight: 1})
  t.equal(str.toString(), 'foo\n')
  t.notOk(str.moveToTop())
  str.move(2)
  t.equal(str.toString(), 'baz\n')
  t.ok(str.moveToTop())
  t.equal(str.toString(), 'foo\n')
  t.end()
})

tape('box.moveToBottom()', function (t) {
  var str = scrollable('foo\nbar\nbaz\n', {maxHeight: 1})
  t.equal(str.toString(), 'foo\n')
  t.ok(str.moveToBottom())
  t.equal(str.toString(), 'baz\n')
  t.notOk(str.moveToBottom())
  t.end()
})

tape('box.up()', function (t) {
  var str = scrollable('foo\nbar\nbaz\n', {maxHeight: 1})
  t.equal(str.toString(), 'foo\n')
  t.notOk(str.up())
  str.move(2)
  t.equal(str.toString(), 'baz\n')
  t.ok(str.up())
  t.equal(str.toString(), 'bar\n')
  t.ok(str.up())
  t.equal(str.toString(), 'foo\n')
  t.notOk(str.up())
  t.end()
})

tape('box.down()', function (t) {
  var str = scrollable('foo\nbar\nbaz\n', {maxHeight: 1})
  t.equal(str.toString(), 'foo\n')
  t.ok(str.down())
  t.equal(str.toString(), 'bar\n')
  t.ok(str.down())
  t.equal(str.toString(), 'baz\n')
  t.notOk(str.down())
  t.end()
})

tape('box.set()', function (t) {
  var str = scrollable({maxHeight: 1})

  str.set('foo\nbar\nbaz\n')

  t.same(str.toString(), 'foo\n')
  t.ok(str.down())
  t.same(str.toString(), 'bar\n')
  t.ok(str.down())
  t.same(str.toString(), 'baz\n')
  t.notOk(str.down())
  t.same(str.toString(), 'baz\n')
  t.ok(str.up())
  t.same(str.toString(), 'bar\n')

  str.moveToTop()
  str.set('1\n2\n')

  t.same(str.toString(), '1\n')
  t.ok(str.down())
  t.same(str.toString(), '2\n')
  t.notOk(str.down())
  t.same(str.toString(), '2\n')
  t.notOk(str.down())
  t.same(str.toString(), '2\n')
  t.ok(str.up())
  t.same(str.toString(), '1\n')

  t.end()
})

tape('minHeight', function (t) {
  var str = scrollable({minHeight: 5})

  str.set('foo\nbar\nbaz\n')
  t.same(str.toString(), 'foo\nbar\nbaz\n\n\n')

  str.set('foo\nbar\nbaz\n1\n2\n3\n4\n')
  t.same(str.toString(), 'foo\nbar\nbaz\n1\n2\n3\n4\n')
  t.end()
})

tape('box.height()', function (t) {
  var str
  str = scrollable('foo\nbar\nbaz\n', {maxHeight: 1})
  t.equal(str.height(), 1)
  str = scrollable('foo\nbar\nbaz\n', {maxHeight: 100})
  t.equal(str.height(), 3)
  str = scrollable('foo\nbar\nbaz\n', {minHeight: 10})
  t.equal(str.height(), 10)
  str = scrollable('foo\nbar\nbaz\n', {minHeight: 10, maxHeight: 100})
  t.equal(str.height(), 10)
  str = scrollable('foo\nbar\nbaz\n', {height: 42})
  t.equal(str.height(), 42)
  t.end()
})

tape('box.resize()', function (t) {
  var str = scrollable('foo\nbar\nbaz\n', {maxHeight: 1})
  t.equal(str.toString(), 'foo\n')
  t.notOk(str.resize({height: 1}))
  t.equal(str.toString(), 'foo\n')
  t.ok(str.resize({height: 2}))
  t.equal(str.toString(), 'foo\nbar\n')
  t.notOk(str.resize({height: 2}))
  t.equal(str.toString(), 'foo\nbar\n')
  t.ok(str.resize({height: 3}))
  t.equal(str.toString(), 'foo\nbar\nbaz\n')
  t.notOk(str.resize({height: 3}))
  t.equal(str.toString(), 'foo\nbar\nbaz\n')
  t.notOk(str.resize({maxHeight: 42}))
  t.equal(str.toString(), 'foo\nbar\nbaz\n')
  t.ok(str.resize({minHeight: 4}))
  t.equal(str.toString(), 'foo\nbar\nbaz\n\n')
  t.notOk(str.resize({minHeight: 4}))
  t.equal(str.toString(), 'foo\nbar\nbaz\n\n')
  t.end()
})

tape('update event', function (t) {
  var str = scrollable('foo\nbar\nbaz\n', {maxHeight: 1})
  var updates = 0
  str.on('update', function () {
    updates++
  })
  t.equal(updates, 0, 'initial value: 0')
  str.up()
  t.equal(updates, 0, 'up: 0 -> 0')
  str.down()
  t.equal(updates, 1, 'down: 0 -> 1')
  str.down()
  t.equal(updates, 2, 'down: 1 -> 2')
  str.down()
  t.equal(updates, 2, 'down: 2 -> 2')
  str.top()
  t.equal(updates, 3, 'top: 2 -> 0')
  str.top()
  t.equal(updates, 3, 'top: 0 -> 0')
  str.bottom()
  t.equal(updates, 4, 'bottom: 0 -> 2')
  str.bottom()
  t.equal(updates, 4, 'bottom: 0 -> 2')
  str.setPosition(1)
  t.equal(updates, 5, 'setPosition: 2 -> 1')
  str.setPosition(1)
  t.equal(updates, 5, 'setPosition: 2 -> 1')
  str.set('new content\nfoo\nbar\nbaz\n')
  t.equal(updates, 6, 'set: 1 -> 1')
  str.resize({height: 42})
  t.equal(updates, 7, 'resize: 1 -> 0')
  str.resize({height: 1})
  t.equal(updates, 8, 'resize: 0 -> 0')
  t.end()
})
